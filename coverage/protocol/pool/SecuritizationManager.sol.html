<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for protocol/pool/SecuritizationManager.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">protocol/pool/</a> SecuritizationManager.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/61</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/82</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/18</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/72</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity 0.8.19;
&nbsp;
import '../note-sale/MintedIncreasingInterestTGE.sol';
import '../../base/UntangledBase.sol';
import '../../base/Factory.sol';
import '../../libraries/ConfigHelper.sol';
import '../../interfaces/IRequiresUID.sol';
&nbsp;
/// @title SecuritizationManager
/// @author Untangled Team
/// @notice You can use this contract for creating new pool, setting up note toke sale, buying note token
contract SecuritizationManager is UntangledBase, Factory, ISecuritizationManager, IRequiresUID {
    using ConfigHelper for Registry;
    uint256[] public allowedUIDTypes;
&nbsp;
    struct NewRoundSaleParam {
        uint256 openingTime;
        uint256 closingTime;
        uint256 rate;
        uint256 cap;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function initialize(Registry _registry) public initializer {</span>
<span class="cstat-no" title="statement not covered" >        __UntangledBase__init(_msgSender())</span>;
&nbsp;
        registry = _registry;
    }
&nbsp;
    event NewTGECreated(address instanceAddress);
    event NewNotesTokenCreated(address instanceAddress);
    event NewPoolCreated(address instanceAddress);
&nbsp;
    //noteSaleAddress, investor, amount, tokenAmount
    event TokensPurchased(address indexed investor, address indexed tgeAddress, uint256 amount, uint256 tokenAmount);
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier onlyPoolExisted(ISecuritizationPool pool) {</span>
<span class="cstat-no" title="statement not covered" >        require(isExistingPools[address(pool)], 'SecuritizationManager: Pool does not exist')</span>;
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier onlyManager(ISecuritizationPool pool) {</span>
<span class="cstat-no" title="statement not covered" >        require(</span>
            pool.hasRole(pool.OWNER_ROLE(), _msgSender()),
            'SecuritizationManager: Not the controller of the project'
        );
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier doesSOTExist(ISecuritizationPool pool) {</span>
<span class="cstat-no" title="statement not covered" >        require(poolToSOT[address(pool)] == address(0), 'SecuritizationManager: Already exists SOT token')</span>;
        _;
    }
<span class="fstat-no" title="function not covered" >    modifier doesJOTExist(ISecuritizationPool pool) {</span>
<span class="cstat-no" title="statement not covered" >        require(poolToJOT[address(pool)] == address(0), 'SecuritizationManager: Already exists JOT token')</span>;
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getPoolsLength() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return pools.length;</span>
    }
&nbsp;
    /// @notice Creates a new securitization pool
    /// @param currency The main currency used in this new pool. Ex: cUSD's address
    /// @param minFirstLossCushion Define the minimum JOT ratio in pool
    /// @dev Creates a new instance of a securitization pool. Set msg sender as owner of the new pool
<span class="fstat-no" title="function not covered" >    function newPoolInstance(address currency, uint32 minFirstLossCushion)</span>
        external
        whenNotPaused
        nonReentrant
        onlyRole(POOL_CREATOR)
        returns (address)
    {
<span class="cstat-no" title="statement not covered" >        address poolImplAddress = address(registry.getSecuritizationPool());</span>
<span class="cstat-no" title="statement not covered" >        address poolAddress = deployMinimal(poolImplAddress);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        ISecuritizationPool poolInstance = ISecuritizationPool(poolAddress);</span>
<span class="cstat-no" title="statement not covered" >        poolInstance.initialize(registry, currency, minFirstLossCushion)</span>;
<span class="cstat-no" title="statement not covered" >        poolInstance.grantRole(poolInstance.OWNER_ROLE(), _msgSender())</span>;
<span class="cstat-no" title="statement not covered" >        poolInstance.renounceRole(poolInstance.OWNER_ROLE(), address(this))</span>;
&nbsp;
        isExistingPools[poolAddress] = true;
<span class="cstat-no" title="statement not covered" >        pools.push(poolInstance)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit NewPoolCreated(poolAddress);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        return poolAddress;</span>
    }
&nbsp;
    /// @notice sets up the initial token generation event (TGE) for the junior tranche (SOT) of a securitization pool
    /// @param issuerTokenController who acts as owner of note sale
    /// @param pool SecuritizationPool address where this sale belongs to
    /// @param saleTypeAndDecimal Contains sale type parameter and decimal value of note token
    /// @param longSale Define this sale is long sale. Default true
    /// @param ticker Prefix for note token symbol name. Ex: Saff_SOT
<span class="fstat-no" title="function not covered" >    function initialTGEForSOT(</span>
        address issuerTokenController,
        ISecuritizationPool pool,
        uint8[] memory saleTypeAndDecimal,
        bool longSale,
        string memory ticker
    ) public whenNotPaused nonReentrant onlyManager(pool) onlyPoolExisted(pool) doesSOTExist(pool) returns (address) {
<span class="cstat-no" title="statement not covered" >        INoteTokenFactory noteTokenFactory = registry.getNoteTokenFactory();</span>
<span class="cstat-no" title="statement not covered" >        require(address(noteTokenFactory) != address(0), 'Note Token Factory was not registered')</span>;
<span class="cstat-no" title="statement not covered" >        require(address(registry.getTokenGenerationEventFactory()) != address(0), 'TGE Factory was not registered')</span>;
&nbsp;
        poolToSOT[address(pool)] = noteTokenFactory.createToken(
            address(pool),
            Configuration.NOTE_TOKEN_TYPE.SENIOR,
            saleTypeAndDecimal[1],
            ticker
        );
<span class="cstat-no" title="statement not covered" >        address sotToken = poolToSOT[address(pool)];</span>
<span class="cstat-no" title="statement not covered" >        require(sotToken != address(0), 'SOT token must be created')</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        address tgeAddress = registry.getTokenGenerationEventFactory().createNewSaleInstance(</span>
            issuerTokenController,
            address(pool),
            sotToken,
            pool.underlyingCurrency(),
            saleTypeAndDecimal[0],
            longSale
        );
<span class="cstat-no" title="statement not covered" >        noteTokenFactory.changeMinterRole(sotToken, tgeAddress)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        pool.injectTGEAddress(tgeAddress, sotToken, Configuration.NOTE_TOKEN_TYPE.SENIOR)</span>;
&nbsp;
        isExistingTGEs[tgeAddress] = true;
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit NewTGECreated(tgeAddress);</span>
<span class="cstat-no" title="statement not covered" >        emit NewNotesTokenCreated(sotToken);</span>
<span class="cstat-no" title="statement not covered" >        return tgeAddress;</span>
    }
&nbsp;
    /// @notice Sets up the token generation event (TGE) for the senior tranche (SOT) of a securitization pool with additional configuration parameters
    /// @param issuerTokenController Who acts as owner of note sale
    /// @param pool SecuritizationPool address where this sale belongs to
    /// @param saleTypeAndDecimal Contains sale type parameter and decimal value of note token
    /// @param longSale Define this sale is long sale. Default true
    /// @param _initialInterest For SOT auction token sale. An initial interest rate is defined
    /// @param _finalInterest For SOT auction token sale. This is the largest interest rate
    /// @param _timeInterval For SOT auction token sale. After every time interval, the current interest rate will increase from initial interest value
    /// @param _amountChangeEachInterval For SOT auction token sale. After every time interval, the current interest rate will increase a value of amountChangeEachInterval
    /// @param saleParam Some parameters for new round token sale. Ex: openingTime, closeTime, totalCap...
    /// @param ticker Prefix for note token symbol name. Ex: Saff_SOT
<span class="fstat-no" title="function not covered" >    function setUpTGEForSOT(</span>
        address issuerTokenController,
        ISecuritizationPool pool,
        uint8[] memory saleTypeAndDecimal,
        bool longSale,
        uint32 _initialInterest,
        uint32 _finalInterest,
        uint32 _timeInterval,
        uint32 _amountChangeEachInterval,
        NewRoundSaleParam memory saleParam,
        string calldata ticker
    ) public {
<span class="cstat-no" title="statement not covered" >        address tgeAddress = initialTGEForSOT(issuerTokenController, pool, saleTypeAndDecimal, longSale, ticker);</span>
<span class="cstat-no" title="statement not covered" >        MintedIncreasingInterestTGE tge = MintedIncreasingInterestTGE(tgeAddress);</span>
<span class="cstat-no" title="statement not covered" >        tge.setInterestRange(_initialInterest, _finalInterest, _timeInterval, _amountChangeEachInterval)</span>;
<span class="cstat-no" title="statement not covered" >        tge.startNewRoundSale(saleParam.openingTime, saleParam.closingTime, saleParam.rate, saleParam.cap)</span>;
    }
&nbsp;
    /// @notice sets up the token generation event (TGE) for the junior tranche (JOT) of a securitization pool with additional configuration parameters
    /// @param issuerTokenController who acts as owner of note sale
    /// @param pool SecuritizationPool address where this sale belongs to
    /// @param saleTypeAndDecimal Contains sale type parameter and decimal value of note token
    /// @param longSale Define this sale is long sale. Default true
    /// @param saleParam Some parameters for new round token sale. Ex: openingTime, closeTime, totalCap...
    /// @param ticker Prefix for note token symbol name. Ex: Saff_JOT
<span class="fstat-no" title="function not covered" >    function setUpTGEForJOT(</span>
        address issuerTokenController,
        ISecuritizationPool pool,
        uint8[] memory saleTypeAndDecimal,
        bool longSale,
        NewRoundSaleParam memory saleParam,
        string calldata ticker
    ) public {
<span class="cstat-no" title="statement not covered" >        address tgeAddress = initialTGEForJOT(issuerTokenController, pool, saleTypeAndDecimal, longSale, ticker);</span>
<span class="cstat-no" title="statement not covered" >        MintedNormalTGE tge = MintedNormalTGE(tgeAddress);</span>
<span class="cstat-no" title="statement not covered" >        tge.startNewRoundSale(saleParam.openingTime, saleParam.closingTime, saleParam.rate, saleParam.cap)</span>;
    }
&nbsp;
    /// @notice sets up the initial token generation event (TGE) for the junior tranche (JOT) of a securitization pool
    /// @param issuerTokenController who acts as owner of note sale
    /// @param pool SecuritizationPool address where this sale belongs to
    /// @param saleTypeAndDecimal Contains sale type parameter and decimal value of note token
    /// @param longSale Define this sale is long sale. Default true
    /// @param ticker Prefix for note token symbol name. Ex: Saff_JOT
<span class="fstat-no" title="function not covered" >    function initialTGEForJOT(</span>
        address issuerTokenController,
        ISecuritizationPool pool,
        uint8[] memory saleTypeAndDecimal,
        bool longSale,
        string memory ticker
    ) public whenNotPaused nonReentrant onlyManager(pool) onlyPoolExisted(pool) doesJOTExist(pool) returns (address) {
<span class="cstat-no" title="statement not covered" >        INoteTokenFactory noteTokenFactory = registry.getNoteTokenFactory();</span>
        poolToJOT[address(pool)] = noteTokenFactory.createToken(
            address(pool),
            Configuration.NOTE_TOKEN_TYPE.JUNIOR,
            saleTypeAndDecimal[1],
            ticker
        );
&nbsp;
<span class="cstat-no" title="statement not covered" >        address jotToken = poolToJOT[address(pool)];</span>
<span class="cstat-no" title="statement not covered" >        require(jotToken != address(0), 'JOT token must be created')</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        address tgeAddress = registry.getTokenGenerationEventFactory().createNewSaleInstance(</span>
            issuerTokenController,
            address(pool),
            jotToken,
            pool.underlyingCurrency(),
            saleTypeAndDecimal[0],
            longSale
        );
<span class="cstat-no" title="statement not covered" >        noteTokenFactory.changeMinterRole(jotToken, tgeAddress)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        pool.injectTGEAddress(tgeAddress, jotToken, Configuration.NOTE_TOKEN_TYPE.JUNIOR)</span>;
&nbsp;
        isExistingTGEs[tgeAddress] = true;
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit NewTGECreated(tgeAddress);</span>
<span class="cstat-no" title="statement not covered" >        emit NewNotesTokenCreated(jotToken);</span>
<span class="cstat-no" title="statement not covered" >        return tgeAddress;</span>
    }
&nbsp;
    /// @notice Investor bid for SOT or JOT token
    /// @param tgeAddress SOT/JOT token sale instance
    /// @param currencyAmount Currency amount investor will pay
<span class="fstat-no" title="function not covered" >    function buyTokens(address tgeAddress, uint256 currencyAmount) external whenNotPaused nonReentrant {</span>
<span class="cstat-no" title="statement not covered" >        require(isExistingTGEs[tgeAddress], 'SMP: Note sale does not exist')</span>;
<span class="cstat-no" title="statement not covered" >        require(hasAllowedUID(_msgSender()), 'Unauthorized. Must have correct UID')</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        MintedIncreasingInterestTGE tge = MintedIncreasingInterestTGE(tgeAddress);</span>
<span class="cstat-no" title="statement not covered" >        uint256 tokenAmount = tge.buyTokens(_msgSender(), _msgSender(), currencyAmount);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        ISecuritizationPool(tge.pool()).onBuyNoteToken(currencyAmount)</span>;
<span class="cstat-no" title="statement not covered" >        emit TokensPurchased(_msgSender(), tgeAddress, currencyAmount, tokenAmount);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setAllowedUIDTypes(uint256[] calldata ids) external onlyRole(DEFAULT_ADMIN_ROLE) {</span>
        allowedUIDTypes = ids;
    }
&nbsp;
    /// @notice Check if an user has valid UID type
<span class="fstat-no" title="function not covered" >    function hasAllowedUID(address sender) public view override returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >        return registry.getGo().goOnlyIdTypes(sender, allowedUIDTypes);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function pausePool(address poolAddress) external whenNotPaused nonReentrant onlyRole(DEFAULT_ADMIN_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        require(isExistingPools[poolAddress], 'SecuritizationManager: pool does not exist')</span>;
<span class="cstat-no" title="statement not covered" >        ISecuritizationPool pool = ISecuritizationPool(poolAddress);</span>
<span class="cstat-no" title="statement not covered" >        pool.pause()</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function unpausePool(address poolAddress) external whenNotPaused nonReentrant onlyRole(DEFAULT_ADMIN_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        require(isExistingPools[poolAddress], 'SecuritizationManager: pool does not exist')</span>;
<span class="cstat-no" title="statement not covered" >        ISecuritizationPool pool = ISecuritizationPool(poolAddress);</span>
<span class="cstat-no" title="statement not covered" >        pool.unpause()</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function pauseAllPools() external whenNotPaused nonReentrant onlyRole(DEFAULT_ADMIN_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 poolsLength = pools.length;</span>
<span class="cstat-no" title="statement not covered" >        for (uint256 i = 0; i &lt; poolsLength; i++) {</span>
<span class="cstat-no" title="statement not covered" >            pools[i].pause()</span>;
        }
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function unpauseAllPools() external whenNotPaused nonReentrant onlyRole(DEFAULT_ADMIN_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 poolsLength = pools.length;</span>
<span class="cstat-no" title="statement not covered" >        for (uint256 i = 0; i &lt; poolsLength; i++) {</span>
<span class="cstat-no" title="statement not covered" >            pools[i].unpause()</span>;
        }
    }
&nbsp;
    uint256[49] private __gap;
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Sep 23 2023 16:10:16 GMT+0700 (Indochina Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
